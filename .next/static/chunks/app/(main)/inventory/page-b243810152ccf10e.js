(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[112],{425:(e,t,a)=>{"use strict";a.d(t,{R:()=>c,j:()=>n});let s="/api",r=e=>{let t=new Headers,a=localStorage.getItem("token");return a&&t.append("Authorization","Bearer ".concat(a)),e&&t.append("Content-Type",e),t},l=async e=>{if(!e.ok){console.error("HTTP error! status: ".concat(e.status,", statusText: ").concat(e.statusText));let t="API Error: ".concat(e.status," ").concat(e.statusText);try{let a=e.headers.get("Content-Type");if(a&&a.includes("application/json")){let a=await e.json();console.log("Error response data:",a),t=a.message||a.error||t}else{let a=await e.text();console.log("Error response text:",a),t=a||t}}catch(e){console.error("Failed to parse error response:",e)}throw Error(t)}try{return await e.json()}catch(e){return console.error("Failed to parse success response as JSON:",e),{}}},c={register:async e=>l(await fetch("".concat(s,"/auth/register"),{method:"POST",body:e})),login:async(e,t)=>l(await fetch("".concat(s,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})})),logout:async()=>l(await fetch("".concat(s,"/auth/logout"),{method:"POST",headers:r()})),getCurrentUser:async()=>l(await fetch("".concat(s,"/auth/me"),{headers:r()})),updateProfile:async e=>l(await fetch("".concat(s,"/auth/update-profile"),{method:"PUT",headers:r(),body:e})),changePassword:async e=>l(await fetch("".concat(s,"/auth/change-password"),{method:"PUT",headers:r("application/json"),body:JSON.stringify(e)}))},n={getAllCars:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams(e);return l(await fetch("".concat(s,"/cars?").concat(t.toString()),{headers:r()}))},getMyListings:async e=>l(await fetch("".concat(s,"/cars/dealer/").concat(e),{headers:r()})),getCarById:async e=>l(await fetch("".concat(s,"/cars/").concat(e),{headers:r()})),createCar:async e=>l(await fetch("".concat(s,"/cars/create"),{method:"POST",headers:r(),body:e})),updateCar:async(e,t)=>l(await fetch("".concat(s,"/cars/").concat(e),{method:"PUT",headers:r(),body:t})),deleteCar:async e=>l(await fetch("".concat(s,"/cars/").concat(e),{method:"DELETE",headers:r()})),updateCarStatus:async(e,t)=>{try{let a=await fetch("".concat(s,"/cars/").concat(e,"/status"),{method:"PUT",headers:r("application/json"),body:JSON.stringify({status:t})});return await l(a)}catch(e){throw e}}}},3274:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,AuthProvider:()=>n});var s=a(5155),r=a(2115),l=a(425);let c=(0,r.createContext)(void 0);function n(e){let{children:t}=e,[a,n]=(0,r.useState)(null),[o,i]=(0,r.useState)(!0),[d,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{i(!0);let e=localStorage.getItem("currentUser");if(e)n(JSON.parse(e));else{let e=await l.R.getCurrentUser();n(e)}}catch(e){n(null)}finally{i(!1)}})()},[]);let y=async(e,t)=>{try{i(!0),h(null);let{token:a,...s}=await l.R.login(e,t);n(s),localStorage.setItem("token",a),console.log("token is :",a),localStorage.setItem("currentUser",JSON.stringify(s))}catch(e){throw h(e instanceof Error?e.message:"Failed to login"),e}finally{i(!1)}},x=async e=>{try{i(!0),h(null);let{token:t,...a}=await l.R.register(e);n(a),localStorage.setItem("token",t),localStorage.setItem("currentUser",JSON.stringify(a))}catch(e){throw h(e instanceof Error?e.message:"Failed to register"),e}finally{i(!1)}},u=async()=>{try{i(!0),h(null),await l.R.logout(),n(null),localStorage.removeItem("token"),localStorage.removeItem("currentUser")}catch(e){throw h(e instanceof Error?e.message:"Failed to logout"),e}finally{i(!1)}};return(0,s.jsx)(c.Provider,{value:{user:a,loading:o,error:d,login:y,register:x,logout:u},children:t})}function o(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4416:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},4631:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]])},6882:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var s=a(5155),r=a(2115),l=a(6874),c=a.n(l),n=a(4631),o=a(2895);let i=(0,o.A)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var d=a(7930);let h=(0,o.A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var y=a(4416);let x=(0,o.A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),u=(0,o.A)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);var g=a(425),m=a(3274);function p(){let{user:e}=(0,m.A)(),[t,a]=(0,r.useState)([]),[l,o]=(0,r.useState)("all"),[p,f]=(0,r.useState)(!0),[v,b]=(0,r.useState)(null),j=async()=>{try{if(f(!0),b(null),!(null==e?void 0:e._id))throw Error("User not authenticated");console.log("Fetching inventory for dealer ID:",e._id);let t=await g.j.getMyListings(e._id);Array.isArray(t)?(a(t),console.log("Loaded inventory (array):",t.length,"cars")):t&&t.cars&&Array.isArray(t.cars)?(a(t.cars),console.log("Loaded inventory (object):",t.cars.length,"cars")):(console.error("Unexpected response format:",t),a([]))}catch(e){b("Failed to load inventory. Please try again."),console.error("Error fetching inventory:",e)}finally{f(!1)}};(0,r.useEffect)(()=>{j()},[e]);let w=async(e,t)=>{try{await g.j.updateCarStatus(e,t),a(a=>a.map(a=>a._id===e?{...a,status:t}:a))}catch(e){b("Failed to update car status: ".concat(e instanceof Error?e.message:"Unknown error"))}},N=async e=>{if(window.confirm("Are you sure you want to delete this listing?"))try{await g.j.deleteCar(e),a(t=>t.filter(t=>t._id!==e))}catch(e){b("Failed to delete car: ".concat(e instanceof Error?e.message:"Unknown error"))}},k="all"===l?t:t.filter(e=>e.status===l),S=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return p?(0,s.jsxs)("div",{className:"p-6 flex flex-col items-center justify-center h-64",children:[(0,s.jsx)(n.A,{className:"w-8 h-8 animate-spin text-primary mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading inventory..."})]}):e?(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"My Inventory"}),(0,s.jsxs)(c(),{href:"/list-car",className:"bg-primary hover:bg-primary-hover text-black px-4 py-2 rounded-lg transition-colors flex items-center gap-2",children:[(0,s.jsx)(d.A,{className:"w-5 h-5"}),"List New Car"]})]}),v&&(0,s.jsxs)("div",{className:"bg-red-50 text-red-700 p-4 rounded-lg mb-6",children:[v,(0,s.jsx)("button",{onClick:j,className:"ml-4 underline hover:text-red-800",children:"Try Again"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex gap-4 mb-4 flex-wrap",children:[(0,s.jsxs)("button",{onClick:()=>o("all"),className:"px-4 py-2 rounded-lg ".concat("all"===l?"bg-gray-200":"hover:bg-gray-100"),children:["All (",t.length,")"]}),(0,s.jsxs)("button",{onClick:()=>o("Available"),className:"px-4 py-2 rounded-lg ".concat("Available"===l?"bg-gray-200":"hover:bg-gray-100"),children:["Available (",t.filter(e=>"Available"===e.status).length,")"]}),(0,s.jsxs)("button",{onClick:()=>o("Sold"),className:"px-4 py-2 rounded-lg ".concat("Sold"===l?"bg-gray-200":"hover:bg-gray-100"),children:["Sold (",t.filter(e=>"Sold"===e.status).length,")"]}),(0,s.jsxs)("button",{onClick:()=>o("Reserved"),className:"px-4 py-2 rounded-lg ".concat("Reserved"===l?"bg-gray-200":"hover:bg-gray-100"),children:["Reserved (",t.filter(e=>"Reserved"===e.status).length,")"]})]}),0===k.length?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No cars found in this category."}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left",children:"Image"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left",children:"Car Details"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left",children:"Price"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left",children:"Listed Date"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200",children:k.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("div",{className:"w-16 h-12 overflow-hidden rounded",children:(0,s.jsx)("img",{src:e.images&&e.images.length>0?e.images[0]:"/placeholder.png",alt:"".concat(e.make," ").concat(e.model),className:"w-full h-full object-cover"})})}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium",children:[e.make," ",e.model]}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[e.year," \xb7 ",e.mileage.toLocaleString()," km \xb7 ",e.condition]})]})}),(0,s.jsxs)("td",{className:"px-4 py-3 font-medium",children:["KSh ",e.price.toLocaleString()]}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("Available"===e.status?"bg-green-100 text-green-800":"Sold"===e.status?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"),children:e.status})}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:S(e.createdAt)}),(0,s.jsx)("td",{className:"px-4 py-3 text-right",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:["Sold"!==e.status&&(0,s.jsx)("button",{onClick:()=>w(e._id,"Sold"),className:"p-1 hover:bg-blue-100 hover:text-blue-800 rounded",title:"Mark as Sold",children:(0,s.jsx)(h,{className:"w-5 h-5"})}),"Reserved"!==e.status&&(0,s.jsx)("button",{onClick:()=>w(e._id,"Reserved"),className:"p-1 hover:bg-yellow-100 hover:text-yellow-800 rounded",title:"Mark as Reserved",children:(0,s.jsx)(y.A,{className:"w-5 h-5"})}),"Available"!==e.status&&(0,s.jsx)("button",{onClick:()=>w(e._id,"Available"),className:"p-1 hover:bg-green-100 hover:text-green-800 rounded",title:"Mark as Available",children:(0,s.jsx)(d.A,{className:"w-5 h-5"})}),(0,s.jsx)(c(),{href:"/edit-car/".concat(e._id),className:"p-1 hover:bg-blue-100 hover:text-blue-800 rounded",title:"Edit Listing",children:(0,s.jsx)(x,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>N(e._id),className:"p-1 hover:bg-red-100 hover:text-red-800 rounded",title:"Delete Listing",children:(0,s.jsx)(u,{className:"w-5 h-5"})})]})})]},e._id))})]})})]})]}):(0,s.jsxs)("div",{className:"p-6 flex flex-col items-center justify-center h-64",children:[(0,s.jsx)(i,{className:"w-8 h-8 text-red-500 mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Access Denied"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"You must be logged in to view and manage inventory."}),(0,s.jsx)(c(),{href:"/login",className:"bg-primary hover:bg-primary-hover text-black px-4 py-2 rounded-lg transition-colors",children:"Login"})]})}},7786:(e,t,a)=>{Promise.resolve().then(a.bind(a,6882))},7930:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[508,441,684,358],()=>t(7786)),_N_E=e.O()}]);